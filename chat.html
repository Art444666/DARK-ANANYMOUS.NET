<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    .section {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      background: #fff;
    }
    .section h3 {
      margin-top: 0;
      color: #333;
    }
    #chat, #userlist {
      list-style: none;
      padding: 0;
    }
    #chat li, #userlist li {
      margin-bottom: 5px;
    }
    .owner {
      font-weight: bold;
      color: darkred;
    }
    input, button {
      margin: 5px;
      padding: 5px;
    }
    .room-card {
      border: 1px solid #ddd;
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      background: #f0f0f0;
    }
    .room-card.private {
      background: #ffecec;
    }
  </style>
</head>
<body>
  <h2>üí¨ –ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç</h2>
  <p>–í—ã: <strong>{{ username }}</strong></p>

  <div class="section" id="roomlist">
    <h3>üìã –°–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç</h3>
    <div id="openRooms"><h4>üîì –û—Ç–∫—Ä—ã—Ç—ã–µ</h4></div>
    <div id="privateRooms"><h4>üîê –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ</h4></div>
  </div>

  <div class="section" id="create-room">
    <h3>‚ûï –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h3>
    <input id="newroom" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" />
    <input id="newpass" placeholder="–ü–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" />
    <button onclick="createRoom()">–°–æ–∑–¥–∞—Ç—å</button>
  </div>

  <div class="section" id="chatbox" style="display:none;">
    <h3>üí¨ –ß–∞—Ç</h3>
    <input id="msg" autocomplete="off" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ /ban –Ω–∏–∫" />
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <ul id="chat"></ul>
  </div>

  <div class="section" id="users">
    <h3>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–Ω–∞—Ç—ã</h3>
    <ul id="userlist"></ul>
    <p id="ownerinfo"></p>
  </div>

  <script>
    const socket = io();

    function createRoom() {
      const room = document.getElementById("newroom").value.trim();
      const password = document.getElementById("newpass").value.trim();
      if (!room) {
        alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã.");
        return;
      }
      socket.emit("create_room", { room, password });
    }

    function joinRoom(room, isPrivate) {
      let password = "";
      if (isPrivate) {
        password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∫–æ–º–Ω–∞—Ç—ã " + room);
      }
      socket.emit("join_room", { room, password });
    }

    socket.on("room_error", msg => alert(msg));

    socket.on("room_list", list => {
      const openContainer = document.getElementById("openRooms");
      const privateContainer = document.getElementById("privateRooms");
      openContainer.innerHTML = "<h4>üîì –û—Ç–∫—Ä—ã—Ç—ã–µ</h4>";
      privateContainer.innerHTML = "<h4>üîê –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ</h4>";

      list.forEach(room => {
        const cleanName = room.replace(" [–ø—Ä–∏–≤–∞—Ç]", "").trim();
        const isPrivate = room.includes("[–ø—Ä–∏–≤–∞—Ç]");

        const card = document.createElement("div");
        card.className = "room-card" + (isPrivate ? " private" : "");
        const title = document.createElement("strong");
        title.textContent = room;
        card.appendChild(title);

        const btn = document.createElement("button");
        btn.textContent = "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è";
        btn.onclick = () => joinRoom(cleanName, isPrivate);
        card.appendChild(btn);

        if (isPrivate) {
          privateContainer.appendChild(card);
        } else {
          openContainer.appendChild(card);
        }
      });
    });

    socket.on("room_joined", room => {
      document.getElementById("chatbox").style.display = "block";
      document.getElementById("chat").innerHTML = "";
    });

    socket.on("message", msg => {
      const li = document.createElement("li");
      li.textContent = msg;
      document.getElementById("chat").appendChild(li);
    });

    socket.on("userlist", data => {
      const ul = document.getElementById("userlist");
      ul.innerHTML = "";
      data.users.forEach(u => {
        const li = document.createElement("li");
        li.textContent = u;
        ul.appendChild(li);
      });
      document.getElementById("ownerinfo").innerHTML = `üëë –í–ª–∞–¥–µ–ª–µ—Ü: <span class="owner">${data.owner}</span>`;
    });

    function sendMessage() {
      const input = document.getElementById("msg");
      socket.send(input.value);
      input.value = "";
    }
  </script>
</body>
</html>





