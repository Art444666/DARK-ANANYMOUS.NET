<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Telegram X</title>
    <script src="https://cdn.socket.io"></script>
    <style>
        :root { --bg: #0e1621; --side: #17212b; --accent: #5288c1; --msg-in: #182533; --msg-out: #2b5278; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; overflow: hidden; }
        
        .app { display: flex; height: 100vh; }
        
        /* SIDEBAR */
        .sidebar { width: 320px; background: var(--side); border-right: 1px solid #000; display: flex; flex-direction: column; position: relative; }
        .search-area { padding: 15px; display: flex; gap: 10px; align-items: center; }
        .search-input { flex: 1; background: #242f3d; border: none; padding: 10px; border-radius: 10px; color: white; outline: none; }
        
        .room-item { padding: 12px 15px; display: flex; align-items: center; gap: 12px; cursor: pointer; transition: 0.2s; }
        .room-item:hover { background: rgba(255,255,255,0.05); }
        .room-avatar { width: 45px; height: 45px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: bold; }
        
        /* CHAT AREA */
        .main { flex: 1; display: flex; flex-direction: column; background: #0e1621 url('https://www.transparenttextures.com'); }
        .header { background: rgba(23,33,43,0.8); backdrop-filter: blur(10px); padding: 10px 20px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid rgba(0,0,0,0.2); }
        
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 75%; padding: 8px 12px; border-radius: 15px; animation: pop 0.3s ease; position: relative; }
        .mine { align-self: flex-end; background: var(--msg-out); border-bottom-right-radius: 2px; }
        .other { align-self: flex-start; background: var(--msg-in); border-bottom-left-radius: 2px; }
        .img-msg { max-width: 100%; border-radius: 10px; margin-top: 5px; }

        .input-bar { padding: 15px; background: var(--side); display: flex; gap: 10px; align-items: center; }
        .fab { position: absolute; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--accent); border: none; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        @keyframes pop { from { opacity: 0; transform: translateY(10px); } }
    </style>
</head>
<body>

<div class="app">
    <div class="sidebar">
        <div class="search-area">
            <div onclick="alert('–ù–∏–∫: {{ username }}')" style="cursor:pointer">‚ò∞</div>
            <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫..." oninput="filterRooms(this.value)">
        </div>
        <div id="roomList" style="flex:1; overflow-y:auto;"></div>
        <button class="fab" onclick="createRoom()">+</button>
    </div>

    <div class="main">
        <div class="header">
            <div class="room-avatar" style="width:40px; height:40px" id="h-av">?</div>
            <div>
                <div id="h-name" style="font-weight:bold">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
                <div id="h-count" style="font-size:12px; color:var(--accent)">–≤ —Å–µ—Ç–∏: 0</div>
            </div>
        </div>
        <div id="chat"></div>
        <div class="input-bar" id="inputBox" style="display:none">
            <input type="file" id="f" hidden onchange="up(this)">
            <button onclick="document.getElementById('f').click()" style="background:none; border:none; color:var(--accent); cursor:pointer; font-size:20px;">üìé</button>
            <input type="text" id="m" class="search-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') send()">
            <button onclick="send()" style="background:none; border:none; color:var(--accent); font-size:24px; cursor:pointer;">‚û§</button>
        </div>
    </div>
</div>

<script>
    const socket = io();
    const myName = "{{ username }}";

    function send() { 
        const i = document.getElementById("m"); 
        if(i.value.trim()){ socket.send(i.value); i.value=""; } 
    }

    function up(input) {
        const reader = new FileReader();
        reader.onload = (e) => socket.emit("message", "IMAGE_DATA:" + e.target.result);
        reader.readAsDataURL(input.files[0]);
    }

    socket.on("room_list", (list) => {
        const cont = document.getElementById("roomList");
        cont.innerHTML = "";
        list.forEach(r => {
            const isP = r.includes("[–ø—Ä–∏–≤–∞—Ç]");
            const name = r.replace(" [–ø—Ä–∏–≤–∞—Ç]", "");
            const d = document.createElement("div");
            d.className = "room-item";
            d.onclick = () => socket.emit("join_room", {room: name, password: isP ? prompt("–ü–∞—Ä–æ–ª—å:") : ""});
            d.innerHTML = `<div class="room-avatar">${name[0].toUpperCase()}</div><div><b>${name}</b></div>`;
            cont.appendChild(d);
        });
    });

    socket.on("room_joined", (name) => {
        document.getElementById("h-name").innerText = name;
        document.getElementById("h-av").innerText = name[0].toUpperCase();
        document.getElementById("inputBox").style.display = "flex";
        document.getElementById("chat").innerHTML = "";
    });

    socket.on("message", (data) => {
        const chat = document.getElementById("chat");
        const div = document.createElement("div");
        const [author, ...text] = data.split(":");
        const isMine = author.trim() === myName;
        
        div.className = "bubble " + (isMine ? "mine" : "other");
        
        const content = text.join(":");
        if(content.includes("IMAGE_DATA:")){
            div.innerHTML = `<small style="color:orange">${author}</small><br><img src="${content.split('IMAGE_DATA:')[1]}" class="img-msg">`;
        } else {
            div.innerHTML = `<small style="color:orange">${author}</small><br>${content}`;
        }
        
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    });

    socket.on("userlist", d => { document.getElementById("h-count").innerText = "–≤ —Å–µ—Ç–∏: " + d.count; });
    socket.on("room_error", e => alert(e));

    function createRoom() {
        const n = prompt("–ò–º—è —á–∞—Ç–∞:");
        if(n) socket.emit("create_room", {room: n, password: prompt("–ü–∞—Ä–æ–ª—å (–ø—É—Å—Ç–æ –¥–ª—è –≤—Å–µ—Ö):")});
    }

    function filterRooms(v) {
        document.querySelectorAll(".room-item").forEach(i => {
            i.style.display = i.innerText.toLowerCase().includes(v.toLowerCase()) ? "flex" : "none";
        });
    }
</script>
</body>
</html>










