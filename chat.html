<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Telegram Chat Ultra</title>
  <script src="https://cdn.socket.io"></script>
  <style>
    :root {
      --bg-dark: #0e1621;
      --bg-side: #17212b;
      --accent: #5288c1;
      --text: #f5f5f5;
      --msg-out: #2b5278;
      --anim-speed: 0.4s;
    }

    body, html { height: 100%; margin: 0; font-family: 'Segoe UI', Roboto; background: var(--bg-dark); color: var(--text); overflow: hidden; }

    /* --- –ê–ù–ò–ú–ê–¶–ò–ò --- */
    @keyframes messagePop { from { opacity: 0; transform: scale(0.9) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    
    /* --- –ú–ï–ù–Æ (DRAWER) --- */
    .drawer {
      position: fixed; left: -320px; top: 0; width: 300px; height: 100%;
      background: var(--bg-side); z-index: 1000; transition: transform var(--anim-speed) cubic-bezier(0.4, 0, 0.2, 1);
      padding: 25px; box-sizing: border-box; box-shadow: 10px 0 20px rgba(0,0,0,0.4);
    }
    .drawer.open { transform: translateX(320px); }
    
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6); 
      opacity: 0; visibility: hidden; transition: var(--anim-speed); z-index: 999;
    }
    .overlay.active { opacity: 1; visibility: visible; }

    /* --- –°–ê–ô–î–ë–ê–† --- */
    .app-wrap { display: flex; height: 100vh; }
    .sidebar { width: 320px; background: var(--bg-side); display: flex; flex-direction: column; border-right: 1px solid #080a0d; }
    
    .header-tools { padding: 15px; display: flex; align-items: center; gap: 12px; }
    .search-input { 
      flex: 1; background: #242f3d; border: none; border-radius: 20px; 
      padding: 8px 15px; color: white; outline: none; transition: 0.3s;
    }
    .search-input:focus { box-shadow: 0 0 0 2px var(--accent); }

    .rooms-list { flex: 1; overflow-y: auto; }
    .room-item { 
      padding: 12px 15px; display: flex; align-items: center; gap: 12px; 
      cursor: pointer; transition: 0.2s; border-radius: 8px; margin: 0 8px;
    }
    .room-item:hover { background: #232e3c; }
    .room-item.hidden { display: none; }

    /* --- –ß–ê–¢ --- */
    .chat-area { flex: 1; display: flex; flex-direction: column; background: #0e1621; position: relative; }
    #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    
    .bubble { 
      max-width: 70%; padding: 10px 14px; border-radius: 15px; 
      font-size: 15px; animation: messagePop 0.3s ease; position: relative;
    }
    .bubble.mine { align-self: flex-end; background: var(--msg-out); border-bottom-right-radius: 4px; }
    .bubble.other { align-self: flex-start; background: #182533; border-bottom-left-radius: 4px; }

    .input-bar { background: var(--bg-side); padding: 15px; display: flex; gap: 10px; }
    .btn-tg { background: none; border: none; color: var(--accent); cursor: pointer; font-weight: bold; font-size: 16px; }
    
    .avatar-circle { 
      width: 45px; height: 45px; border-radius: 50%; background: var(--accent);
      display: flex; align-items: center; justify-content: center; font-weight: bold;
    }
  </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeDrawer()"></div>

<!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<div class="drawer" id="drawer">
  <h2 style="color: var(--accent)">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
  <div style="margin-bottom: 25px;">
    <label style="font-size: 12px; color: gray;">–í–ê–® –ù–ò–ö</label>
    <input type="text" id="newNick" class="search-input" style="width: 100%; margin-top: 5px;" placeholder="–ù–∏–∫–Ω–µ–π–º...">
    <button class="btn-tg" style="margin-top: 10px;" onclick="updateNick()">–û–ë–ù–û–í–ò–¢–¨</button>
  </div>
  
  <div style="border-top: 1px solid #242f3d; padding-top: 20px;">
    <button class="btn-tg" onclick="tryAdmin()">üîí –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
  </div>
</div>

<div class="app-wrap">
  <div class="sidebar">
    <div class="header-tools">
      <div style="cursor:pointer; font-size: 24px;" onclick="openDrawer()">‚ò∞</div>
      <input type="text" class="search-input" id="roomSearch" placeholder="–ü–æ–∏—Å–∫ –∫–æ–º–Ω–∞—Ç..." oninput="filterRooms()">
    </div>
    <div class="rooms-list" id="roomsList">
      <!-- –°–ø–∏—Å–æ–∫ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ -->
    </div>
  </div>

  <div class="chat-area">
    <div id="messages"></div>
    <div class="input-bar">
      <input type="text" id="msgInput" class="search-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') send()">
      <button class="btn-tg" onclick="send()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
    </div>
  </div>
</div>

<script>
  const socket = io();

  // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é
  function openDrawer() {
    document.getElementById('drawer').classList.add('open');
    document.getElementById('overlay').classList.add('active');
  }
  function closeDrawer() {
    document.getElementById('drawer').classList.remove('open');
    document.getElementById('overlay').classList.remove('active');
  }

  // –ü–æ–∏—Å–∫ –∫–æ–º–Ω–∞—Ç (–†–∞–±–æ—á–∏–π —Ñ–∏–ª—å—Ç—Ä)
  function filterRooms() {
    const val = document.getElementById('roomSearch').value.toLowerCase();
    const items = document.querySelectorAll('.room-item');
    items.forEach(item => {
      const name = item.querySelector('.r-name').innerText.toLowerCase();
      item.classList.toggle('hidden', !name.includes(val));
    });
  }

  // –ê–¥–º–∏–Ω–∫–∞ —Å —Ç–≤–æ–∏–º –ø–∞—Ä–æ–ª–µ–º
  function tryAdmin() {
    const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞:");
    if (pass === "94488") {
      socket.emit("admin_login", { password: pass });
      alert("–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω!");
    } else {
      alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!");
    }
  }

  function updateNick() {
    const n = document.getElementById('newNick').value;
    if(n) { socket.emit("change_nickname", n); closeDrawer(); }
  }

  // Socket logic –¥–ª—è —Å–ø–∏—Å–∫–∞
  socket.on("room_list", list => {
    const listEl = document.getElementById("roomsList");
    listEl.innerHTML = "";
    list.forEach(room => {
      const isPrivate = room.includes("[–ø—Ä–∏–≤–∞—Ç]");
      const cleanName = room.replace(" [–ø—Ä–∏–≤–∞—Ç]", "");
      const div = document.createElement("div");
      div.className = "room-item";
      div.onclick = () => socket.emit("join_room", { room: cleanName, password: isPrivate ? prompt("–ü–∞—Ä–æ–ª—å:") : "" });
      div.innerHTML = `
        <div class="avatar-circle">${cleanName[0].toUpperCase()}</div>
        <div>
          <div class="r-name" style="font-weight:600">${cleanName} ${isPrivate ? 'üîê' : ''}</div>
          <div style="font-size:12px; color:gray">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—Ö–æ–¥–∞</div>
        </div>
      `;
      listEl.appendChild(div);
    });
  });

  socket.on("message", msg => {
    const chat = document.getElementById("messages");
    const b = document.createElement("div");
    // –õ–æ–≥–∏–∫–∞ mine/other –æ–±—ã—á–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∏–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    b.className = "bubble other"; 
    b.textContent = msg;
    chat.appendChild(b);
    chat.scrollTop = chat.scrollHeight;
  });

  function send() {
    const i = document.getElementById("msgInput");
    if(i.value) { socket.send(i.value); i.value = ""; }
  }
</script>
</body>
</html>


