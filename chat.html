<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ANONYMOUS.NET</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #chat, #userlist { list-style: none; padding: 0; }
    #chat li, #userlist li { margin-bottom: 5px; }
    .owner { font-weight: bold; color: darkred; }
    input, button { margin: 5px; padding: 5px; }
    #roomlist { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>üí¨ –ß–∞—Ç</h2>
  <p>–í—ã: <strong>{{ username }}</strong></p>

  <div id="roomlist">
    <h3>üìã –ö–æ–º–Ω–∞—Ç—ã</h3>
    <ul id="rooms">
      {% for room, info in rooms.items() %}
        <li>
          {{ room }} {% if info.private %}[–ø—Ä–∏–≤–∞—Ç]{% endif %}
          <button onclick="joinRoom('{{ room }}', {{ 'true' if info.private else 'false' }})">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
        </li>
      {% endfor %}
    </ul>
  </div>

  <h3>‚ûï –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h3>
  <div id="create-room">
    <input id="newroom" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" />
    <input id="newpass" placeholder="–ü–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" />
    <button onclick="createRoom()">–°–æ–∑–¥–∞—Ç—å</button>
  </div>

  <div id="chatbox" style="display:none;">
    <h3>üí¨ –ß–∞—Ç</h3>
    <input id="msg" autocomplete="off" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ /ban –Ω–∏–∫" />
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <ul id="chat"></ul>

    <h3>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
    <ul id="userlist"></ul>
    <p id="ownerinfo"></p>
  </div>

  <script>
    const socket = io();

    function createRoom() {
      const room = document.getElementById("newroom").value.trim();
      const password = document.getElementById("newpass").value.trim();
      if (!room) {
        alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã.");
        return;
      }
      socket.emit("create_room", { room, password });
    }

    function joinRoom(room, isPrivate) {
      let password = "";
      if (isPrivate) {
        password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∫–æ–º–Ω–∞—Ç—ã " + room);
      }
      socket.emit("join_room", { room, password });
    }

    socket.on("room_error", msg => alert(msg));

    socket.on("room_list", list => {
      const ul = document.getElementById("rooms");
      ul.innerHTML = "";
      list.forEach(room => {
        const cleanName = room.replace(" [–ø—Ä–∏–≤–∞—Ç]", "").trim();
        const li = document.createElement("li");
        li.textContent = room;
        const btn = document.createElement("button");
        btn.textContent = "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è";
        btn.onclick = () => joinRoom(cleanName, room.includes("[–ø—Ä–∏–≤–∞—Ç]"));
        li.appendChild(btn);
        ul.appendChild(li);
      });
    });

    socket.on("room_joined", room => {
      document.getElementById("chatbox").style.display = "block";
      document.getElementById("chat").innerHTML = "";
    });

    socket.on("message", msg => {
      const li = document.createElement("li");
      li.textContent = msg;
      document.getElementById("chat").appendChild(li);
    });

    socket.on("userlist", data => {
      const ul = document.getElementById("userlist");
      ul.innerHTML = "";
      data.users.forEach(u => {
        const li = document.createElement("li");
        li.textContent = u;
        ul.appendChild(li);
      });
      document.getElementById("ownerinfo").innerHTML = `üëë –í–ª–∞–¥–µ–ª–µ—Ü: <span class="owner">${data.owner}</span>`;
    });

    function sendMessage() {
      const input = document.getElementById("msg");
      socket.send(input.value);
      input.value = "";
    }
  </script>
</body>
</html>

