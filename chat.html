<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Telegram Chat Elite</title>
  <script src="https://cdn.socket.io"></script>
  <style>
    :root {
      --bg-dark: #0e1621;
      --bg-side: #17212b;
      --accent: #5288c1;
      --text: #f5f5f5;
      --msg-out: #2b5278;
      --msg-in: #182533;
      --anim: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body, html { height: 100%; margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: var(--text); overflow: hidden; }

    /* --- –ê–ù–ò–ú–ê–¶–ò–ò --- */
    @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* --- DRAWER --- */
    .drawer {
      position: fixed; left: -310px; top: 0; width: 300px; height: 100%;
      background: var(--bg-side); z-index: 1000; transition: var(--anim);
      padding: 25px; box-sizing: border-box; box-shadow: 10px 0 30px rgba(0,0,0,0.5);
    }
    .drawer.open { transform: translateX(310px); }
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.7); 
      opacity: 0; visibility: hidden; transition: var(--anim); z-index: 999;
    }
    .overlay.active { opacity: 1; visibility: visible; }

    /* --- LAYOUT --- */
    .app-wrap { display: flex; height: 100vh; }
    
    .sidebar { 
      width: 320px; background: var(--bg-side); display: flex; flex-direction: column; 
      border-right: 1px solid #080a0d; position: relative;
    }
    
    .header-tools { padding: 15px; display: flex; align-items: center; gap: 12px; }
    
    .search-input { 
      flex: 1; background: #242f3d; border: none; border-radius: 20px; 
      padding: 10px 15px; color: white; outline: none; font-size: 14px;
    }

    .rooms-list { flex: 1; overflow-y: auto; padding-bottom: 80px; }
    
    /* –ö–ù–û–ü–ö–ê –°–û–ó–î–ê–¢–¨ (TG Style FAB) */
    .fab-create {
      position: absolute; bottom: 20px; right: 20px;
      width: 56px; height: 56px; border-radius: 50%;
      background: var(--accent); color: white; border: none;
      font-size: 24px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      transition: var(--anim); display: flex; align-items: center; justify-content: center;
    }
    .fab-create:hover { transform: scale(1.1) rotate(90deg); background: #6398d1; }

    /* --- CHAT AREA --- */
    .chat-area { flex: 1; display: flex; flex-direction: column; position: relative; }
    .chat-header { background: var(--bg-side); padding: 12px 20px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 6px; }
    
    .bubble { 
      max-width: 75%; padding: 8px 14px; border-radius: 12px; 
      font-size: 15px; animation: slideUp 0.2s ease-out; word-wrap: break-word;
    }
    .bubble.mine { align-self: flex-end; background: var(--msg-out); border-bottom-right-radius: 2px; }
    .bubble.other { align-self: flex-start; background: var(--msg-in); border-bottom-left-radius: 2px; }

    .input-bar { background: var(--bg-side); padding: 15px; display: flex; gap: 10px; align-items: center; }
    .btn-send { background: none; border: none; color: var(--accent); cursor: pointer; font-size: 22px; transition: 0.2s; }
    .btn-send:hover { transform: scale(1.2); }

    .room-item { 
      padding: 12px 15px; display: flex; align-items: center; gap: 12px; 
      cursor: pointer; transition: 0.2s; border-radius: 10px; margin: 2px 8px;
    }
    .room-item:hover { background: #232e3c; }
    .room-item.active { background: var(--accent); }
    .room-item.hidden { display: none; }

    .avatar { width: 48px; height: 48px; border-radius: 50%; background: #5288c1; display: flex; align-items: center; justify-content: center; font-weight: bold; }
  </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeDrawer()"></div>

<!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<div class="drawer" id="drawer">
  <h2 style="color: var(--accent); margin-top: 0;">–ú–µ–Ω—é</h2>
  <div style="margin-bottom: 25px;">
    <label style="font-size: 11px; color: #8e959b; text-transform: uppercase;">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</label>
    <input type="text" id="newNick" class="search-input" style="width: 100%; margin-top: 8px;" placeholder="–í–∞—à –Ω–æ–≤—ã–π –Ω–∏–∫...">
    <button class="btn-send" style="font-size: 14px; margin-top: 10px;" onclick="updateNick()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
  </div>
  
  <div style="border-top: 1px solid #242f3d; padding-top: 20px;">
    <button class="btn-send" style="font-size: 14px; color: #ff6b6b;" onclick="tryAdmin()">üîë –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</button>
  </div>
</div>

<div class="app-wrap">
  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="header-tools">
      <div style="cursor:pointer; font-size: 22px;" onclick="openDrawer()">‚ò∞</div>
      <input type="text" class="search-input" id="roomSearch" placeholder="–ü–æ–∏—Å–∫..." oninput="filterRooms()">
    </div>
    
    <div class="rooms-list" id="roomsList"></div>

    <!-- –ö–ù–û–ü–ö–ê –°–û–ó–î–ê–¢–¨ -->
    <button class="fab-create" onclick="createRoomDialog()" title="–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É">+</button>
  </div>

  <!-- CHAT AREA -->
  <div class="chat-area">
    <div class="chat-header">
      <div class="avatar" id="currentAvatar" style="width: 35px; height: 35px; font-size: 14px;">?</div>
      <div id="roomTitle" style="font-weight: 600;">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
    </div>
    
    <div id="messages"></div>

    <div class="input-bar" id="inputArea" style="display: none;">
      <input type="text" id="msgInput" class="search-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') send()">
      <button class="btn-send" onclick="send()">‚û§</button>
    </div>
  </div>
</div>

<script>
  const socket = io();
  let myNick = "{{ username }}";

  function openDrawer() { document.getElementById('drawer').classList.add('open'); document.getElementById('overlay').classList.add('active'); }
  function closeDrawer() { document.getElementById('drawer').classList.remove('open'); document.getElementById('overlay').classList.remove('active'); }

  // –ü–æ–∏—Å–∫ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
  function filterRooms() {
    const query = document.getElementById('roomSearch').value.toLowerCase();
    document.querySelectorAll('.room-item').forEach(item => {
      const name = item.dataset.name.toLowerCase();
      item.classList.toggle('hidden', !name.includes(query));
    });
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
  function createRoomDialog() {
    const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç—ã:");
    if (!name) return;
    const pass = prompt("–ü–∞—Ä–æ–ª—å (–ø—É—Å—Ç–æ, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω):");
    socket.emit("create_room", { room: name, password: pass });
  }

  function tryAdmin() {
    const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞:");
    if (pass === "94488") {
      socket.emit("admin_login", { password: pass });
      alert("–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
    } else {
      alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞.");
    }
  }

  function updateNick() {
    const n = document.getElementById('newNick').value;
    if(n) { 
      socket.emit("change_nickname", { nickname: n }); 
      myNick = n;
      closeDrawer();
    }
  }

  socket.on("room_list", list => {
    const container = document.getElementById("roomsList");
    container.innerHTML = "";
    list.forEach(room => {
      const isPrivate = room.includes("[–ø—Ä–∏–≤–∞—Ç]");
      const cleanName = room.replace(" [–ø—Ä–∏–≤–∞—Ç]", "");
      const div = document.createElement("div");
      div.className = "room-item";
      div.dataset.name = cleanName;
      div.onclick = () => {
        const p = isPrivate ? prompt("–ü–∞—Ä–æ–ª—å:") : "";
        socket.emit("join_room", { room: cleanName, password: p });
      };
      div.innerHTML = `
        <div class="avatar" style="background: ${isPrivate ? '#4a3d4d' : '#5288c1'}">${cleanName[0].toUpperCase()}</div>
        <div>
          <div style="font-weight:600">${cleanName} ${isPrivate ? 'üîê' : ''}</div>
          <div style="font-size:12px; color:gray">–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤–æ–π—Ç–∏</div>
        </div>
      `;
      container.appendChild(div);
    });
  });

  socket.on("room_joined", room => {
    document.getElementById("roomTitle").innerText = room;
    document.getElementById("currentAvatar").innerText = room[0].toUpperCase();
    document.getElementById("inputArea").style.display = "flex";
    document.getElementById("messages").innerHTML = "";
  });

  socket.on("message", msg => {
    const container = document.getElementById("messages");
    const div = document.createElement("div");
    // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –≤–∞—à–µ–≥–æ –Ω–∏–∫–∞, –æ–Ω–æ –±—É–¥–µ—Ç —Å–ø—Ä–∞–≤–∞
    const isMine = msg.startsWith(myNick);
    div.className = `bubble ${isMine ? 'mine' : 'other'}`;
    div.textContent = msg;
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
  });

  function send() {
    const inp = document.getElementById("msgInput");
    if(inp.value.trim()) { socket.send(inp.value); inp.value = ""; }
  }
</script>
</body>
</html>




